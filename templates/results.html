<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title style="font-family: 'Copperplate', serif;">CHW | AVM 1.1.0.2 Log</title>
    <style>
        body {
            background-color: #121212;
            color: #FFFFFF;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            overflow-x: hidden; /* Prevent horizontal overflow */
        }
        h1 {
            text-align: center;
            margin-top: 20px;
            font-family: 'Arial', serif;
        }
        #search-bar {
            width: calc(100% - 40px);
            padding: 10px;
            margin: 20px auto;
            display: block;
            font-size: 16px;
            border: none;
            border-radius: 4px;
        }
        table {
            width: calc(100% - 40px);
            margin: 0 auto;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #444;
        }
        th {
            background-color: #333;
        }
        tr:hover {
            background-color: #444;
        }
        .highlight {
            background-color: #FFD700;
            color: #000;
        }
    </style>
</head>
<body>
    <h1>CHW | AVM 1.1.0.2 Log</h1>
    <input type="text" id="search-bar" placeholder="Search..." onkeyup="search()">
    <table id="results-table">
        <thead>
            <tr>
                <th>Question</th>
                <th>Answer</th>
                <th>Timestamp</th>
            </tr>
        </thead>
        <tbody id="results-body">
            {% for doc in documents %}
            <tr>
                <td>{{ doc.question }}</td>
                <td>{{ doc.answer }}</td>
                <td>{{ doc.timestamp | datetimeformat }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <script>
        async function search() {
            const query = document.getElementById('search-bar').value;
            const response = await fetch(`/search?q=${query}`);
            const data = await response.json();
            const resultsBody = document.getElementById('results-body');
            resultsBody.innerHTML = '';

            if (data.length === 0) {
                resultsBody.innerHTML = '<tr><td colspan="3">No results found</td></tr>';
                return;
            }

            data.forEach(doc => {
                const row = document.createElement('tr');
                const questionCell = document.createElement('td');
                questionCell.innerHTML = highlightText(doc.question, query);
                const answerCell = document.createElement('td');
                answerCell.innerHTML = highlightText(doc.answer, query);
                const timestampCell = document.createElement('td');
                timestampCell.textContent = doc.timestamp;
                row.appendChild(questionCell);
                row.appendChild(answerCell);
                row.appendChild(timestampCell);
                resultsBody.appendChild(row);
            });
        }

        function highlightText(text, query) {
            const regex = new RegExp(`(${query})`, 'gi');
            return text.replace(regex, '<span class="highlight">$1</span>');
        }

        function refreshPage() {
            window.location.reload();
        }
        setInterval(refreshPage, 10000);  // Refresh the page every 10 seconds
    </script>
</body>
</html>
